(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-public-pub-edit-vac"],{"0014":function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,'@charset "UTF-8";\n/*************************** 自定义色彩[wm] ***************************/\n/*************************** 自定义色彩[wm] ***************************/\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.apply-vacation .content .form-wrapper[data-v-6fff5090]{padding:0 %?30?% 0;background-color:#fff}.apply-vacation .content .form-wrapper .switch[data-v-6fff5090]{background-color:red}.apply-vacation .content .btn[data-v-6fff5090]{font-size:%?28?%;color:#fff;background-color:#3685f1;margin-top:%?60?%}.apply-vacation .content .pagenation[data-v-6fff5090]{display:flex;align-items:center;justify-content:center;margin-top:%?30?%}.apply-vacation .content .pagenation .next[data-v-6fff5090]{margin-left:%?30?%}',""]),t.exports=e},"368d":function(t,e,a){"use strict";a("7db0"),a("e25e"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("3626"),n={data:function(){return{currentIndex:1,isPassed:!1,title:"申请假条",submitTitle:"提交",isInitDetialForm:!1,isSelectAdvise:!1,detailForm:{checkName:"",checkStatus:"",urgentContactName:"",urgentContactTel:""},detailFormRules:{checkName:[{required:!0,message:"请输入审核人（辅导员）",trigger:["blur","change"]}],checkStatus:[{required:!0,message:"请选择审核意见",trigger:["blur","change"]}],urgentContactName:[{required:!0,message:"请填写紧急联系人",trigger:["blur","change"]}],urgentContactTel:[{required:!0,message:"请填写紧急联系电话",trigger:["blur","change"]}]},textareaHeight:100,labelWidth:"30%",rules:{type:[{required:!0,message:"请选择假条类型",trigger:["blur","change"]}],startTime:[{required:!0,message:"请选择开始时间",trigger:["blur","change"]}],endTime:[{required:!0,message:"请选择结束时间",trigger:["blur","change"]}],reason:[{required:!0,message:"请填写理由",trigger:["blur","change"]}],statusLabel:[{required:!0,message:"请选择假条状态",trigger:["blur","change"]}],checkName:[{required:!0,message:"请输入审核人（辅导员）",trigger:["blur","change"]}],checkStatus:[{required:!0,message:"请选择审核意见",trigger:["blur","change"]}],urgentContactName:[{required:!0,message:"请填写紧急联系人",trigger:["blur","change"]}],urgentContactTel:[{required:!0,message:"请填写紧急联系电话",trigger:["blur","change"]}]},form:{type:"",startTime:"",endTime:"",reason:"",isTellParent:!1,isLeaveSchool:!0,status:"",statusLabel:"",checkName:"",checkStatus:"",urgentContactName:"",urgentContactTel:""},isTypeSelect:!1,isStimeSelect:!1,isEtimeSelect:!1,isPassSelect:!1,params:{year:!0,month:!0,day:!0,hour:!0,minute:!0,second:!1},types:[{label:"事假",value:"0"},{label:"病假",value:"1"}],status:[{label:"未审核",value:"0"},{label:"未通过",value:"1"},{label:"已完成",value:"2"},{label:"审核通过",value:"3"}],advises:[{label:"未审核",value:"0"},{label:"未通过",value:"1"},{label:"已完成",value:"2"},{label:"同意",value:"3"}],action:"",vacation:null,vacationDetail:null}},onLoad:function(t){try{this.initData();var e=t.action;switch(this.action=e,e){case"add":this.title="申请假条",this.submitTitle="提交";var a=this.vacationDetail.maxId,i=_.cloneDeep(this.vacationDetail.data.clone);i.id=++a,this.vacation=i,this.freshForm(this.vacation);break;case"edit":this.title="续假",this.submitTitle="保存";var n=parseInt(t.id);if(!n)return void this.error("程序出错",{back:!0});this.vacation=this.findVac(n),this.freshForm(this.vacation),console.log("[onLoad]vac:",this.vacation);break}}catch(s){this.error(s,{back:!0})}},onReady:function(){this.$nextTick((function(){this.$refs.uForm.setRules(this.rules)}))},methods:{confirmAction:function(t,e){switch(t){case 1:this.form.checkStatus=e[0].label;break}},pickerAction:function(t){switch(t){case 1:this.isSelectAdvise=!0;break}},btnAction:function(t){switch(console.log(t),t){case 1:this.currentIndex=1;break;case 2:this.currentIndex=2,this.isLookNext=!0;break}},warning:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.toast(t,"warning",e,a)},error:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.toast(t,"error",e,a)},success:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.toast(t,"success",e,a)},toast:function(t,e,a,i){this.$nextTick((function(){this.$refs.uToast.show({title:t,type:e,params:a,callback:i})}))},getLastIdIndex:function(){this.freshVacDetail();var t=this.vacationDetail.data.list,e=t.length;return{id:t[e-1].id,index:e-1}},getIndex:function(t){var e=-1;return this.vacationDetail.data.list.find((function(a,i){return e=i,a.id==t})),e},findVac:function(t){return this.vacationDetail.data.list.find((function(e){return t==e.id}))},sortVacList:function(t){var e=this;return t=this._.orderBy(t,(function(t){var a=e.$dayjs(t.detail.startTime,i.FORMATSECOND).unix();return a}),"desc"),t},save:function(){if(this.vacationDetail.data.list=this.sortVacList(this.vacationDetail.data.list),this.vacationDetail.data.list.length>=i.MAXLENGTH){var t=this.vacationDetail.data.list.pop();this.$log(t)}uni.setStorageSync(i.VACATIONDETAIL,this.vacationDetail)},saveVac:function(t,e){this.vacationDetail.data.list[t]=e,this.save()},freshVacDetail:function(){this.vacationDetail=uni.getStorageSync(i.VACATIONDETAIL)},freshVac:function(t){return this.vacation.detail.status=parseInt(this.form.status),this.vacation},freshForm:function(t){switch(this.$log(t,"vac"),this.form=t.detail,this.form.status=t.detail.status,this.form.status){case 0:this.form.statusLabel="未审核";break;case 1:this.form.statusLabel="未通过";break;case 2:this.form.statusLabel="已完成";break;case 3:this.form.statusLabel="审核通过";break}return this.form},submit:function(){var t=this,e=!1;if(this.$refs.uForm.validate((function(a){a?(e=!0,t.$log("验证通过","验证"),t.$log(t.form,"form")):console.log("验证失败")})),e){if(!this.isLookNext)return this.$toast(this,"请瞥一眼下一步",3);var a=this;switch(this.action){case"add":this.freshVac(this.form),this.$log(this.vacation,"this.vacation-before"),this.vacation=r(this.vacation),this.$log(this.vacation,"this.vacation"),this.vacationDetail.data.list.push(this.vacation),this.vacationDetail.maxId++,this.save(),uni.$emit("refreshVacDetailAction"),this.success("创建成功，假条编号为："+this.vacation.id,{},(function(){uni.navigateBack({})})),console.log("vacationDetail:",this.vacationDetail);break;case"edit":console.log("[edited]vac:",this.vacation);var n=this.freshVac(this.form),s=this.getIndex(n.id);this.saveVac(s,n),uni.$emit("refreshVacDetailAction"),this.success("续假成功！",{},(function(){uni.navigateBack({})}));break}}function r(t){var e=o(t);return t.detail.checkTime=e.checkTime,t.detail.applyTime=e.applyTime,t}function o(t){if(t){var e=t.detail.startTime;e=a.$dayjs(e,"YYYY-MM-DD HH:mm:ss");var n=e.subtract(r(10,30),"minute").add(r(0,60),"second"),s=e.subtract(r(30,60),"minute").add(r(0,60),"second");return{checkTime:n.format(i.FORMATSECOND,"startTime"),applyTime:s.format(i.FORMATSECOND,"startTime")}}function r(t,e){return Math.floor(Math.random()*(e-10)+t)}}},typeConfirm:function(t){this.form.type=t&&t[0]&&t[0].label},sTimeConfirm:function(t){this.form.startTime=this.formatDate(t)},eTimeConfirm:function(t){var e=this.formatDate(t);this.form.endTime=e},statusConfirm:function(t){this.form.statusLabel=t&&t[0]&&t[0].label,this.form.status=t&&t[0]&&t[0].value},formatDate:function(t){console.log("day:",t.day);var e=new Date(t.year,t.month-1,t.day,t.hour,t.minute);return this.$dayjs(e).format(i.FORMATSECOND)},typeSelect:function(){this.isTypeSelect=!0},sTimeSelect:function(){this.isStimeSelect=!0},eTimeSelect:function(){this.isEtimeSelect=!0},commit:function(){console.log("请假成功");var t={type:this.type,startTime:this.startTime,endTime:this.endTime,reason:this.reason,isTellParent:this.isTellParent,isLeaveSchool:this.isLeaveSchool};console.log("currentVacInfo:",t),this.$Router.push("/pages/vacation/vacation")},confirm:function(t){console.log("e:",t)},initData:function(){this.vacationDetail=uni.getStorageSync(i.VACATIONDETAIL)}}};e.default=n},"38da":function(t,e,a){"use strict";a.r(e);var i=a("368d"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},8143:function(t,e,a){"use strict";var i=a("8672"),n=a.n(i);n.a},8672:function(t,e,a){var i=a("0014");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("21d31759",i,!0,{sourceMap:!1,shadowMode:!1})},b7d2:function(t,e,a){"use strict";a.r(e);var i=a("e210"),n=a("38da");for(var s in n)"default"!==s&&function(t){a.d(e,t,(function(){return n[t]}))}(s);a("8143");var r,o=a("f0c5"),l=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"6fff5090",null,!1,i["a"],r);e["default"]=l.exports},e210:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return i}));var i={uNavbar:a("78a2").default,uForm:a("f321").default,uFormItem:a("5ccf").default,uInput:a("1cc9").default,uSwitch:a("559a").default,uButton:a("d760").default,uSelect:a("9f5a").default,uPicker:a("1b2b").default,uToast:a("ec20").default},n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"apply-vacation"},[a("v-uni-view",{staticClass:"navbar"},[a("u-navbar",{attrs:{"back-text":t.title,title:"","border-bottom":!1}},[a("v-uni-view",{attrs:{slot:"right"},slot:"right"},[a("wechat-menu",{staticClass:"wechat-menu-wrapper"})],1)],1)],1),a("v-uni-view",{staticClass:"content"},[a("u-form",{ref:"uForm",attrs:{model:t.form}},[a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:1==t.currentIndex,expression:"currentIndex==1"}],staticClass:"form-wrapper"},[a("u-form-item",{attrs:{"label-width":t.labelWidth,label:"请假类型",prop:"type"}},[a("u-input",{attrs:{type:"select",placeholder:"请选择"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.isTypeSelect=!t.isTypeSelect}},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}})],1),a("u-form-item",{attrs:{"label-width":t.labelWidth,label:"开始时间",prop:"startTime"}},[a("u-input",{attrs:{type:"select",placeholder:"请选择"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.isStimeSelect=!t.isStimeSelect}},model:{value:t.form.startTime,callback:function(e){t.$set(t.form,"startTime",e)},expression:"form.startTime"}})],1),a("u-form-item",{attrs:{"label-width":t.labelWidth,label:"结束时间",prop:"endTime"}},[a("u-input",{attrs:{type:"select",placeholder:"请选择"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.isEtimeSelect=!t.isEtimeSelect}},model:{value:t.form.endTime,callback:function(e){t.$set(t.form,"endTime",e)},expression:"form.endTime"}})],1),a("u-form-item",{attrs:{"label-position":"top","label-width":t.labelWidth,label:"请假原因",prop:"reason"}},[a("u-input",{attrs:{type:"textarea",height:t.textareaHeight,placeholder:"样例假条，请修改您想修改的地方","auto-height":!0},model:{value:t.form.reason,callback:function(e){t.$set(t.form,"reason",e)},expression:"form.reason"}})],1),a("u-form-item",{attrs:{"label-width":t.labelWidth,label:"是否告知家长",prop:"isTellParent"}},[a("u-switch",{staticClass:"switch",model:{value:t.form.isTellParent,callback:function(e){t.$set(t.form,"isTellParent",e)},expression:"form.isTellParent"}})],1),a("u-form-item",{attrs:{"label-width":t.labelWidth,label:"是否离开学校",prop:"isLeaveSchool"}},[a("u-switch",{model:{value:t.form.isLeaveSchool,callback:function(e){t.$set(t.form,"isLeaveSchool",e)},expression:"form.isLeaveSchool"}})],1),a("u-form-item",{attrs:{"label-width":t.labelWidth,label:"选择假条状态",prop:"statusLabel","border-bottom":!1}},[a("u-input",{attrs:{type:"select",placeholder:"请选择"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.isPassSelect=!t.isPassSelect}},model:{value:t.form.statusLabel,callback:function(e){t.$set(t.form,"statusLabel",e)},expression:"form.statusLabel"}})],1)],1),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:2==t.currentIndex,expression:"currentIndex==2"}],staticClass:"form-wrapper"},[a("v-uni-view",{staticClass:"page2"},[a("u-form-item",{attrs:{"label-width":t.labelWidth,label:"审核人(辅导员)",prop:"checkName"}},[a("u-input",{attrs:{type:"text",placeholder:"请输入审核人"},model:{value:t.form.checkName,callback:function(e){t.$set(t.form,"checkName",e)},expression:"form.checkName"}})],1),a("u-form-item",{attrs:{"label-width":t.labelWidth,label:"紧急联系人",prop:"urgentContactName"}},[a("u-input",{attrs:{type:"text",placeholder:"请填写"},model:{value:t.form.urgentContactName,callback:function(e){t.$set(t.form,"urgentContactName",e)},expression:"form.urgentContactName"}})],1),a("u-form-item",{attrs:{"label-width":t.labelWidth,label:"紧急联系电话",prop:"urgentContactTel"}},[a("u-input",{attrs:{type:"text",placeholder:"请填写"},model:{value:t.form.urgentContactTel,callback:function(e){t.$set(t.form,"urgentContactTel",e)},expression:"form.urgentContactTel"}})],1)],1)],1)],1),a("v-uni-view",{staticClass:"pagenation"},[a("v-uni-view",{staticClass:"pre"},[a("u-button",{attrs:{size:"mini",disabled:1==t.currentIndex},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.btnAction(1)}}},[t._v("上一步")])],1),a("v-uni-view",{staticClass:"next"},[a("u-button",{attrs:{size:"mini",disabled:2==t.currentIndex},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.btnAction(2)}}},[t._v("下一步")])],1)],1),a("v-uni-button",{staticClass:"btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}},[t._v(t._s(t.submitTitle))])],1),a("u-select",{attrs:{mode:"single-column",list:t.types},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.typeConfirm.apply(void 0,arguments)}},model:{value:t.isTypeSelect,callback:function(e){t.isTypeSelect=e},expression:"isTypeSelect"}}),a("u-picker",{attrs:{mode:"time",params:t.params},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.sTimeConfirm.apply(void 0,arguments)}},model:{value:t.isStimeSelect,callback:function(e){t.isStimeSelect=e},expression:"isStimeSelect"}}),a("u-picker",{attrs:{mode:"time",params:t.params},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.eTimeConfirm.apply(void 0,arguments)}},model:{value:t.isEtimeSelect,callback:function(e){t.isEtimeSelect=e},expression:"isEtimeSelect"}}),a("u-select",{attrs:{mode:"single-column",list:t.status},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.statusConfirm.apply(void 0,arguments)}},model:{value:t.isPassSelect,callback:function(e){t.isPassSelect=e},expression:"isPassSelect"}}),a("u-toast",{ref:"uToast"}),a("n-toast",{ref:"nToast"})],1)},s=[]}}]);